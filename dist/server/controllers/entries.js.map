{"version":3,"sources":["../../../server/controllers/entries.js"],"names":["EntryController","queries","getAllEntries","bind","searchEntries","postEntry","putEntry","deleteEntry","req","res","entriesInPage","allEntries","pageNumber","parseInt","query","page","Number","isNaN","status","send","errorMessage","getEntries","getEntriesWithPag","getEntriesWithNoPag","on","row","push","done","length","entries","total","body","search","searchEntriesWithPag","entry","title","content","substring","trim","newTitle","setTitle","newEntry","addEntry","insertEntry","successMessage","updatedEntry","titleUpdated","setTitleForUpdate","contentUpdated","setContentForUpdate","newDate","Date","update","updateEntry"],"mappings":";;;;;;;;;;AAAA;;;;;;;;AAQA;;;;IAIqBA,e;AACnB;;;;;AAKA,2BAAYC,OAAZ,EAAqB;AAAA;;AACnB,SAAKA,OAAL,GAAeA,OAAf;AACA,SAAKC,aAAL,GAAqB,KAAKA,aAAL,CAAmBC,IAAnB,CAAwB,IAAxB,CAArB;AACA,SAAKC,aAAL,GAAqB,KAAKA,aAAL,CAAmBD,IAAnB,CAAwB,IAAxB,CAArB;AACA,SAAKE,SAAL,GAAiB,KAAKA,SAAL,CAAeF,IAAf,CAAoB,IAApB,CAAjB;AACA,SAAKG,QAAL,GAAgB,KAAKA,QAAL,CAAcH,IAAd,CAAmB,IAAnB,CAAhB;AACA,SAAKI,WAAL,GAAmB,KAAKA,WAAL,CAAiBJ,IAAjB,CAAsB,IAAtB,CAAnB;AACD;;AAGD;;;;;;;;;;;;;;;;6BAWcK,G,EAAKC,G,EAAK;AACtB,YAAMC,gBAAgB,EAAtB;AACA,YAAMC,aAAa,EAAnB;AACA,YAAIC,aAAaC,SAASL,IAAIM,KAAJ,CAAUC,IAAnB,EAAyB,EAAzB,CAAjB;;AAEA,YAAI,CAACP,IAAIM,KAAJ,CAAUC,IAAf,EAAqB;AAAEH,uBAAa,CAAb;AAAiB;AACxC,YAAII,OAAOC,KAAP,CAAaL,UAAb,KAA4BA,eAAe,CAA/C,EAAkD;AAChD,iBAAOH,IAAIS,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAC1BC,8EAAwDZ,IAAIM,KAAJ,CAAUC,IAAlE;AAD0B,WAArB,CAAP;AAGD;;AAED,YAAMM,aAAa,KAAKpB,OAAL,CAAaqB,iBAAb,CAA+Bd,GAA/B,EAAoCI,UAApC,CAAnB;AACA,YAAMW,sBAAsB,KAAKtB,OAAL,CAAaC,aAAb,CAA2BM,GAA3B,CAA5B;;AAEAa,mBAAWG,EAAX,CAAc,KAAd,EAAqB,UAACC,GAAD,EAAS;AAC5Bf,wBAAcgB,IAAd,CAAmBD,GAAnB;AACD,SAFD;;AAIAF,4BAAoBC,EAApB,CAAuB,KAAvB,EAA8B,UAACC,GAAD,EAAS;AACrCd,qBAAWe,IAAX,CAAgBD,GAAhB;AACD,SAFD;;AAIAJ,mBAAWG,EAAX,CAAc,KAAd,EAAqB,YAAM;AACzBhB,cAAImB,IAAJ;AACA,cAAIjB,cAAckB,MAAd,KAAyB,CAA7B,EAAgC;AAC9B,mBAAOnB,IAAIS,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAAEC,cAAc,qBAAhB,EAArB,CAAP;AACD;;AAEDG,8BAAoBC,EAApB,CAAuB,KAAvB,EAA8B,YAAM;AAClChB,gBAAImB,IAAJ;;AAEA,mBAAOlB,IAAIS,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAC1BU,uBAASnB,aADiB;AAE1BoB,qBAAOnB,WAAWiB;AAFQ,aAArB,CAAP;AAID,WAPD;AAQD,SAdD;AAeD;;;;;AAGD;;;;;;;;;;;;;;;6BAWcpB,G,EAAKC,G,EAAK;AACtB,YAAMC,gBAAgB,EAAtB;AACA,YAAMC,aAAa,EAAnB;AACA,YAAIC,aAAaC,SAASL,IAAIM,KAAJ,CAAUC,IAAnB,EAAyB,EAAzB,CAAjB;;AAEA,YAAI,CAACP,IAAIM,KAAJ,CAAUC,IAAf,EAAqB;AAAEH,uBAAa,CAAb;AAAiB;AACxC,YAAII,OAAOC,KAAP,CAAaL,UAAb,KAA4BA,eAAe,CAA/C,EAAkD;AAChD,iBAAOH,IAAIS,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAC1BC,8EAAwDZ,IAAIM,KAAJ,CAAUC,IAAlE;AAD0B,WAArB,CAAP;AAGD;;AAED,YAAI,CAACP,IAAIuB,IAAJ,CAASC,MAAd,EAAsB;AAAExB,cAAIuB,IAAJ,CAASC,MAAT,GAAkB,EAAlB;AAAuB;AAC/C,YAAMX,aAAa,KAAKpB,OAAL,CAAagC,oBAAb,CAAkCzB,GAAlC,EAAuCI,UAAvC,CAAnB;AACA,YAAMW,sBAAsB,KAAKtB,OAAL,CAAaG,aAAb,CAA2BI,GAA3B,CAA5B;;AAEAa,mBAAWG,EAAX,CAAc,KAAd,EAAqB,UAACC,GAAD,EAAS;AAAEf,wBAAcgB,IAAd,CAAmBD,GAAnB;AAA0B,SAA1D;AACAF,4BAAoBC,EAApB,CAAuB,KAAvB,EAA8B,UAACC,GAAD,EAAS;AACrCd,qBAAWe,IAAX,CAAgBD,GAAhB;AACD,SAFD;;AAIAJ,mBAAWG,EAAX,CAAc,KAAd,EAAqB,YAAM;AACzBhB,cAAImB,IAAJ;AACA,cAAIhB,WAAWiB,MAAX,KAAsB,CAA1B,EAA6B;AAC3B,mBAAOnB,IAAIS,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAAEC,cAAc,qBAAhB,EAArB,CAAP;AACD;;AAEDG,8BAAoBC,EAApB,CAAuB,KAAvB,EAA8B,YAAM;AAClChB,gBAAImB,IAAJ;;AAEA,mBAAOlB,IAAIS,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAC1BU,uBAASlB,UADiB;AAE1BmB,qBAAOnB,WAAWiB;AAFQ,aAArB,CAAP;AAID,WAPD;AAQD,SAdD;AAeD;;;;;AAGD;;;;;;;;;;;wBAOSpB,G,EAAKC,G,EAAK;AACjB,eAAOA,IAAIS,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBX,IAAI0B,KAAzB,CAAP;AACD;;;;;AAGD;;;;;;;;;;;wBAOSC,K,EAAOC,O,EAAS;AACvB,YAAI,CAACD,KAAL,EAAY;AACV,iBAAOC,QAAQC,SAAR,CAAkB,CAAlB,EAAqB,EAArB,CAAP;AACD;AACD,eAAOF,KAAP;AACD;;;;;AAED;;;;;;;;;;;;;;;yBAWU3B,G,EAAKC,G,EAAK;AAClB,YAAI0B,QAAQ,EAAZ;AACA,YAAI3B,IAAIuB,IAAJ,CAASI,KAAb,EAAoB;AAClBA,kBAAQ3B,IAAIuB,IAAJ,CAASI,KAAT,CAAeG,IAAf,EAAR;AACD;AACD,YAAMF,UAAU5B,IAAIuB,IAAJ,CAASK,OAAT,CAAiBE,IAAjB,EAAhB;AACA,YAAMC,WAAW,KAAKC,QAAL,CAAcL,KAAd,EAAqBC,OAArB,CAAjB;AACA,YAAMK,WAAW,EAAjB;AACA,YAAMC,WAAW,KAAKzC,OAAL,CAAa0C,WAAb,CAAyBnC,GAAzB,EAA8B+B,QAA9B,EAAwCH,OAAxC,CAAjB;;AAEAM,iBAASlB,EAAT,CAAY,KAAZ,EAAmB,UAACC,GAAD,EAAS;AAC1BgB,mBAASf,IAAT,CAAcD,GAAd;AACD,SAFD;;AAIAiB,iBAASlB,EAAT,CAAY,KAAZ,EAAmB,YAAM;AACvBhB,cAAImB,IAAJ;AACA,cAAIe,QAAJ,EAAc;AACZ,mBAAOjC,IAAIS,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAC1ByB,8BAAgB,0BADU,EACkBH;AADlB,aAArB,CAAP;AAGD;;AAED,iBAAOhC,IAAIS,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAC1BC,0BAAc;AADY,WAArB,CAAP;AAGD,SAXD;AAYD;;;;;AAED;;;;;;;;;;;iCAOkBe,K,EAAOD,K,EAAO;AAC9B,YAAI,CAACC,KAAL,EAAY;AACV,iBAAOD,MAAMC,KAAb;AACD;AACD,eAAOA,KAAP;AACD;;;;;AAGD;;;;;;;;;;;mCAOoBC,O,EAASF,K,EAAO;AAClC,YAAI,CAACE,OAAL,EAAc;AACZ,iBAAOF,MAAME,OAAb;AACD;AACD,eAAOA,OAAP;AACD;;;;;AAED;;;;;;;;;;;;;;;wBAWS5B,G,EAAKC,G,EAAK;AACjB,YAAMoC,eAAe,EAArB;;AAEA,YAAIV,QAAQ,EAAZ;AACA,YAAIC,UAAU,EAAd;;AAEA,YAAI5B,IAAIuB,IAAJ,CAASI,KAAb,EAAoB;AAAEA,kBAAQ3B,IAAIuB,IAAJ,CAASI,KAAT,CAAeG,IAAf,EAAR;AAAgC;AACtD,YAAI9B,IAAIuB,IAAJ,CAASK,OAAb,EAAsB;AAAEA,oBAAU5B,IAAIuB,IAAJ,CAASK,OAAT,CAAiBE,IAAjB,EAAV;AAAoC;;AAE5D,YAAMQ,eAAe,KAAKC,iBAAL,CAAuBZ,KAAvB,EAA8B3B,IAAI0B,KAAlC,CAArB;AACA,YAAMc,iBAAiB,KAAKC,mBAAL,CAAyBb,OAAzB,EAAkC5B,IAAI0B,KAAtC,CAAvB;AACA,YAAMgB,UAAU,IAAIC,IAAJ,EAAhB;AACA,YAAMC,SAAS,KAAKnD,OAAL,CAAaoD,WAAb,CAAyB7C,GAAzB,EAA8BsC,YAA9B,EAA4CE,cAA5C,EAA4DE,OAA5D,CAAf;;AAEAE,eAAO5B,EAAP,CAAU,KAAV,EAAiB,UAACC,GAAD,EAAS;AAAEoB,uBAAanB,IAAb,CAAkBD,GAAlB;AAAyB,SAArD;AACA2B,eAAO5B,EAAP,CAAU,KAAV,EAAiB,YAAM;AACrBhB,cAAImB,IAAJ;AACA,cAAIyB,MAAJ,EAAY;AACV,mBAAO3C,IAAIS,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAC1ByB,8BAAgB,4BADU,EACoBV,OAAOW;AAD3B,aAArB,CAAP;AAGD;;AAED,iBAAOpC,IAAIS,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAC1BC,0BAAc;AADY,WAArB,CAAP;AAGD,SAXD;AAYD;;;;;AAGD;;;;;;;;;;;;;;;2BAWYZ,G,EAAKC,G,EAAK;AACpB,YAAMF,cAAc,KAAKN,OAAL,CAAaM,WAAb,CAAyBC,GAAzB,CAApB;;AAEA,YAAID,WAAJ,EAAiB;AACf,iBAAOE,IAAIS,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAC1ByB,4BAAgB;AADU,WAArB,CAAP;AAGD;;AAED,eAAOnC,IAAIS,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAC1BC,wBAAc;AADY,SAArB,CAAP;AAGD;;;;;;;;;qBApRkBpB,e","file":"entries.js","sourcesContent":["/**\n * @fileOverview this JS file contains logic for entry's APIs logic\n *\n * @author  Victor Ukafor\n * @version 1.0.0\n *\n */\n\n/**\n  *  class EntryController\n  *\n  */\nexport default class EntryController {\n  /**\n    *  constructor\n    *  Takes one parameters\n    *  @param {object} queries the only parameter\n    */\n  constructor(queries) {\n    this.queries = queries;\n    this.getAllEntries = this.getAllEntries.bind(this);\n    this.searchEntries = this.searchEntries.bind(this);\n    this.postEntry = this.postEntry.bind(this);\n    this.putEntry = this.putEntry.bind(this);\n    this.deleteEntry = this.deleteEntry.bind(this);\n  }\n\n\n  /** An API for fetching all entries:\n  *  GET: api/v1/entries\n  *  Takes 2 parameters\n  *  @param {object} req the first parameter\n  *  @param  {object} res the second parameter\n  *\n  *  @returns {object} return an object\n  *\n  * The logic behind this was inspired by 'PostreSQL and NodeJS' article on 'www.mherman.com'\n  * see full link https://mherman.org/blog/2015/02/12/postgresql-and-nodejs/\n  */\n  getAllEntries(req, res) {\n    const entriesInPage = [];\n    const allEntries = [];\n    let pageNumber = parseInt(req.query.page, 10);\n\n    if (!req.query.page) { pageNumber = 1; }\n    if (Number.isNaN(pageNumber) || pageNumber === 0) {\n      return res.status(400).send({\n        errorMessage: `You've entered an invalid page number: ${req.query.page}`\n      });\n    }\n\n    const getEntries = this.queries.getEntriesWithPag(req, pageNumber);\n    const getEntriesWithNoPag = this.queries.getAllEntries(req);\n\n    getEntries.on('row', (row) => {\n      entriesInPage.push(row);\n    });\n\n    getEntriesWithNoPag.on('row', (row) => {\n      allEntries.push(row);\n    });\n\n    getEntries.on('end', () => {\n      req.done();\n      if (entriesInPage.length === 0) {\n        return res.status(404).send({ errorMessage: 'You have no entries' });\n      }\n\n      getEntriesWithNoPag.on('end', () => {\n        req.done();\n\n        return res.status(200).send({\n          entries: entriesInPage,\n          total: allEntries.length\n        });\n      });\n    });\n  }\n\n\n  /** An API for searching for specific entries:\n  *  POST: api/v1/entries/search?page=pageNumber\n  *  Takes 2 parameters\n  *  @param {object} req the first parameter\n  *  @param  {object} res the second parameter\n  *\n  *  @returns {object} return an object\n  *\n  * The logic behind this was inspired by 'PostreSQL and NodeJS' article on 'www.mherman.com'\n  * see full link https://mherman.org/blog/2015/02/12/postgresql-and-nodejs/\n  */\n  searchEntries(req, res) {\n    const entriesInPage = [];\n    const allEntries = [];\n    let pageNumber = parseInt(req.query.page, 10);\n\n    if (!req.query.page) { pageNumber = 1; }\n    if (Number.isNaN(pageNumber) || pageNumber === 0) {\n      return res.status(400).send({\n        errorMessage: `You've entered an invalid page number: ${req.query.page}`\n      });\n    }\n\n    if (!req.body.search) { req.body.search = ''; }\n    const getEntries = this.queries.searchEntriesWithPag(req, pageNumber);\n    const getEntriesWithNoPag = this.queries.searchEntries(req);\n\n    getEntries.on('row', (row) => { entriesInPage.push(row); });\n    getEntriesWithNoPag.on('row', (row) => {\n      allEntries.push(row);\n    });\n\n    getEntries.on('end', () => {\n      req.done();\n      if (allEntries.length === 0) {\n        return res.status(404).send({ errorMessage: 'You have no entries' });\n      }\n\n      getEntriesWithNoPag.on('end', () => {\n        req.done();\n\n        return res.status(200).send({\n          entries: allEntries,\n          total: allEntries.length\n        });\n      });\n    });\n  }\n\n\n  /** An API for fetching a single entries:\n  *  GET: api/v1/entries/<entryId>\n  *  Takes 2 parameters\n  *  @param {object} req the first parameter\n  *  @param  {object} res the second parameter\n  *  @returns {object} return an object\n  */\n  getEntry(req, res) {\n    return res.status(200).send(req.entry);\n  }\n\n\n  /** method for setting the title in postEntry method\n  *  Takes 2 parameters\n  *  @param {string} title the first parameter\n  *  @param  {string} content the second parameter\n  *\n  *  @returns {string} return an string\n  */\n  setTitle(title, content) {\n    if (!title) {\n      return content.substring(0, 20);\n    }\n    return title;\n  }\n\n  /** An API for adding a new diary entry:\n  *  POST: api/v1/entries\n  *  Takes 2 parameters\n  *  @param {object} req the first parameter\n  *  @param  {object} res the second parameter\n  *\n  *  @returns {object} return an object\n  *\n  * The logic behind this was inspired by 'PostreSQL and NodeJS' article on 'www.mherman.com'\n  * see full link https://mherman.org/blog/2015/02/12/postgresql-and-nodejs/\n  */\n  postEntry(req, res) {\n    let title = '';\n    if (req.body.title) {\n      title = req.body.title.trim();\n    }\n    const content = req.body.content.trim();\n    const newTitle = this.setTitle(title, content);\n    const newEntry = [];\n    const addEntry = this.queries.insertEntry(req, newTitle, content);\n\n    addEntry.on('row', (row) => {\n      newEntry.push(row);\n    });\n\n    addEntry.on('end', () => {\n      req.done();\n      if (addEntry) {\n        return res.status(201).send({\n          successMessage: 'Entry added successfully', newEntry\n        });\n      }\n\n      return res.status(500).send({\n        errorMessage: 'Internal Server error'\n      });\n    });\n  }\n\n  /** method for setting the title in updateEntry method\n  *  Takes 2 parameters\n  *  @param {string} title the first parameter\n  *  @param  {string} entry the second parameter\n  *\n  *  @returns {string} return an string\n  */\n  setTitleForUpdate(title, entry) {\n    if (!title) {\n      return entry.title;\n    }\n    return title;\n  }\n\n\n  /** method for setting the content in updateEntry method\n  *  Takes 2 parameters\n  *  @param {string} content the first parameter\n  *  @param  {string} entry the second parameter\n  *\n  *  @returns {string} return an string\n  */\n  setContentForUpdate(content, entry) {\n    if (!content) {\n      return entry.content;\n    }\n    return content;\n  }\n\n  /** An API for modifying diary entry:\n  *  POST: api/v1/entries/<entryId>\n  *  Takes 2 parameters\n  *  @param {object} req the first parameter\n  *  @param  {object} res the second parameter\n  *\n  *  @returns {object} return an object\n  *\n  * The logic behind this was inspired by 'PostreSQL and NodeJS' article on 'www.mherman.com'\n  * see full link https://mherman.org/blog/2015/02/12/postgresql-and-nodejs/\n  */\n  putEntry(req, res) {\n    const updatedEntry = [];\n\n    let title = '';\n    let content = '';\n\n    if (req.body.title) { title = req.body.title.trim(); }\n    if (req.body.content) { content = req.body.content.trim(); }\n\n    const titleUpdated = this.setTitleForUpdate(title, req.entry);\n    const contentUpdated = this.setContentForUpdate(content, req.entry);\n    const newDate = new Date();\n    const update = this.queries.updateEntry(req, titleUpdated, contentUpdated, newDate);\n\n    update.on('row', (row) => { updatedEntry.push(row); });\n    update.on('end', () => {\n      req.done();\n      if (update) {\n        return res.status(200).send({\n          successMessage: 'Entry updated successfully', entry: updatedEntry\n        });\n      }\n\n      return res.status(500).send({\n        errorMessage: 'Internal server error'\n      });\n    });\n  }\n\n\n  /** An API for deleting a diary entry:\n  *  DELETE: api/v1/entries/<entryId>\n  *  Takes 2 parameters\n  *  @param {object} req the first parameter\n  *  @param  {object} res the second parameter\n  *\n  *  @returns {object} return an object\n  *\n  * The logic behind this was inspired by 'PostreSQL and NodeJS' article on 'www.mherman.com'\n  * see full link https://mherman.org/blog/2015/02/12/postgresql-and-nodejs/\n  */\n  deleteEntry(req, res) {\n    const deleteEntry = this.queries.deleteEntry(req);\n\n    if (deleteEntry) {\n      return res.status(200).send({\n        successMessage: 'Entry deleted successfully'\n      });\n    }\n\n    return res.status(500).send({\n      errorMessage: 'Internal server error!'\n    });\n  }\n}\n"]}